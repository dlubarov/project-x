<!DOCTYPE html>
<html>
<head>
    <title>Chloe</title>
    <link rel="stylesheet" type="text/css" href="reset.css"></link>
    <link rel="stylesheet" type="text/css" href="style.css"></link>
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <link rel="stylesheet" type="text/css"
      href="https://js.api.here.com/v3/3.0/mapsjs-ui.css" />
    <link rel="stylesheet" type="text/css" href="defaults.css">
    <script type="text/javascript" charset="UTF-8"
      src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
    <script type="text/javascript" charset="UTF-8"
      src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
    <script type="text/javascript" charset="UTF-8"
      src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
    <script type="text/javascript" charset="UTF-8"
      src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
    <script type="text/javascript" charset="UTF-8" src="defaults.js"></script>
    <script type="text/javascript" charset="UTF-8" src="releaseRequests.js"></script>
    <script src="http://code.responsivevoice.org/responsivevoice.js"></script>
    <script src="lodash.js"></script>
    <script src="http://cdn.pubnub.com/pubnub-3.7.1.min.js"></script>
    <script src="https://apis.google.com/js/client.js"></script>
    <script type="text/javascript" src="events.js"></script>
    <script type="text/javascript" src="pubnub.js"></script>
    <script type="text/javascript" src="view-list.js"></script>
</head>
<body onload="calendarSetup(); setupAll()">
  <div id="pager">
    <div class="slide slide1">
      <h1>Good Morning, Daniel.</h1>
      <div id="items"></div>
    </div>
    <div class="slide slide2" style="left: 100%">
      <div id="map" style="width: 100%; height: 700px; background: grey"></div>
    </div>
    <div class="slide slide3" style="top: 100%">
      <div id="directions">
        <div class="noteContainer">
            <div id="releaseInfoTxt" style="display:none; left:0; top:0; z-index: 0;" value="Used Service Releases:/n"></div>
        </div>
        <div id="mapContainer" />
        
        <script type="text/javascript">
        /* 
            author domschuette
            (C) HERE 2014
        */

        function display_route(start_coords, end_coords, event_name, event_location, event_time) {
            $('.noteContainer').append('<div id="eventName">' + event_name + '</div>');
            $('.noteContainer').append('<div id="eventLocation">' + event_location + '</div>');
            $('.noteContainer').append('<div id="eventTime">' + event_time + '</div>');

            // Check whether the environment should use hi-res maps
            var hidpi = ('devicePixelRatio' in window && devicePixelRatio > 1);

            var mapContainer = document.getElementById('mapContainer'),

            platform = new H.service.Platform({
                app_code: app_code,
                app_id: app_id,
                useCIT: true, 
                useHTTPS: true,
            }),
            maptypes = platform.createDefaultLayers(hidpi ? 512 : 256, hidpi ? 320 : null),
            router = platform.getRoutingService(),
            
            map = new H.Map(mapContainer, maptypes.normal.map, 
                {
                    center: new H.geo.Point((start_coords.lat + end_coords.lat) / 2, (start_coords.lng + end_coords.lng) / 2),
                    zoom: 12
                }
            );
            
            // add behavior control
            new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
            
            // Enable the default UI
            var ui = H.ui.UI.createDefault(map, maptypes);
            //add JS API Release information
            releaseInfoTxt.innerHTML+="JS API: 3."+ H.buildInfo().version;
    
            //add MRS Release information
            loadMRSVersionTxt();

            //helper
            var releaseRoutingShown = false;
            
            // setup the Streetlevel imagery
            platform.configure(H.map.render.panorama.RenderEngine);
            
            window.addEventListener('resize', function() { map.getViewPort().resize(); });
            
            function calculateRoute()
            {
                var calculateRouteParams = {
                    'waypoint0': start_coords.lat + "," + start_coords.lng,
                    'waypoint1': end_coords.lat + "," + end_coords.lng,
                    'mode': 'fastest;car;traffic:disabled',
                    'representation': 'display'
                },
                onResult = function(result) {
                      //add Routing Release number if not already done
                    if (releaseRoutingShown== false){
                        releaseInfoTxt.innerHTML+="<br />HLP Routing: "+result.response.metaInfo.moduleVersion; 
                        releaseRoutingShown = true;
                    }
                    var strip = new H.geo.Strip(),
                        shape = result.response.route[0].shape, 
                        i,
                        l = shape.length;
                
                    for(i = 0; i < l; i++)
                    {
                        strip.pushLatLngAlt.apply(strip, shape[i].split(',').map(function(item) { return parseFloat(item); }));
                    }
                    var polyline = new H.map.Polyline(strip, 
                    {
                        style: 
                        {
                            lineWidth: 10,
                            strokeColor: "rgba(0, 128, 0, 0.7)"
                        }   
                    });
                    
                    map.addObject(polyline);
                },
                onError = function(error) {
                    console.log(error);
                }
                router.calculateRoute(calculateRouteParams, onResult, onError);
            }
            
            var displayReady = function(e)
            {
                console.log("fire"); 
                map.removeEventListener("mapviewchangeend", displayReady); 
                calculateRoute();
            };

            map.addEventListener("mapviewchangeend", displayReady);
            // calculateRoute();
        }
        </script>
      </div>
    </div>
  </div>
</body>
<script type="text/javascript" src="view-graph.js"></script>
<script type="text/javascript" src="touch-events.js"></script>
<script type="text/javascript" src="view-init.js"></script>
</html>
